<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `sql_function` macro in crate `oration`."><meta name="keywords" content="rust, rustlang, rust-lang, sql_function"><title>oration::schema::preferences::columns::_impl_query_id_for_value::diesel::sql_function - Rust</title><link rel="stylesheet" type="text/css" href="../../../../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../../../../dark.css"><link rel="stylesheet" type="text/css" href="../../../../../../light.css" id="themeStyle"><script src="../../../../../../storage.js"></script></head><body class="rustdoc macro"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><div class="sidebar-elems"><p class='location'><a href='../../../../../index.html'>oration</a>::<wbr><a href='../../../../index.html'>schema</a>::<wbr><a href='../../../index.html'>preferences</a>::<wbr><a href='../../index.html'>columns</a>::<wbr><a href='../index.html'>_impl_query_id_for_value</a>::<wbr><a href='index.html'>diesel</a></p><script>window.sidebarCurrent = {name: 'sql_function', ty: 'macro', relpath: ''};</script><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../../../../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../../../../../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><input class="search-input" name="search" autocomplete="off" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><a id="settings-menu" href="../../../../../../settings.html"><img src="../../../../../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span></span><span class='in-band'>Macro <a href='../../../../../index.html'>oration</a>::<wbr><a href='../../../../index.html'>schema</a>::<wbr><a href='../../../index.html'>preferences</a>::<wbr><a href='../../index.html'>columns</a>::<wbr><a href='../index.html'>_impl_query_id_for_value</a>::<wbr><a href='index.html'>diesel</a>::<wbr><a class="macro" href=''>sql_function</a></span></h1><div class="docblock type-decl"><pre class="rust macro">
<span class="macro">macro_rules</span><span class="macro">!</span> <span class="ident">sql_function</span> {
    ( $ ( # $ <span class="ident">meta</span> : <span class="ident">tt</span> ) <span class="op">*</span> <span class="kw">fn</span> $ <span class="ident">fn_name</span> : <span class="ident">ident</span> $ <span class="ident">args</span> : <span class="ident">tt</span> $ ( ; ) <span class="op">*</span> ) <span class="op">=&gt;</span> { ... };
    (
$ ( # $ <span class="ident">meta</span> : <span class="ident">tt</span> ) <span class="op">*</span> <span class="kw">fn</span> $ <span class="ident">fn_name</span> : <span class="ident">ident</span> $ <span class="ident">args</span> : <span class="ident">tt</span> <span class="op">-&gt;</span> $ <span class="ident">return_type</span> : <span class="ident">ty</span> $
( ; ) <span class="op">*</span> ) <span class="op">=&gt;</span> { ... };
    ( $ ( # $ <span class="ident">meta</span> : <span class="ident">tt</span> ) <span class="op">*</span> <span class="kw">fn</span> $ <span class="ident">fn_name</span> : <span class="ident">ident</span> <span class="op">&lt;</span> $ ( $ <span class="ident">tokens</span> : <span class="ident">tt</span> ) <span class="op">*</span> ) <span class="op">=&gt;</span> { ... };
    (
$ <span class="ident">fn_name</span> : <span class="ident">ident</span> , $ <span class="ident">struct_name</span> : <span class="ident">ident</span> , $ <span class="ident">args</span> : <span class="ident">tt</span> <span class="op">-&gt;</span> $ <span class="ident">return_type</span> : <span class="ident">ty</span>
) <span class="op">=&gt;</span> { ... };
    (
$ <span class="ident">fn_name</span> : <span class="ident">ident</span> , $ <span class="ident">struct_name</span> : <span class="ident">ident</span> , $ <span class="ident">args</span> : <span class="ident">tt</span> <span class="op">-&gt;</span> $ <span class="ident">return_type</span> : <span class="ident">ty</span>
, $ <span class="ident">docs</span> : <span class="ident">expr</span> ) <span class="op">=&gt;</span> { ... };
    (
$ <span class="ident">fn_name</span> : <span class="ident">ident</span> , $ <span class="ident">struct_name</span> : <span class="ident">ident</span> , (
$ ( $ <span class="ident">arg_name</span> : <span class="ident">ident</span> : $ <span class="ident">arg_type</span> : <span class="ident">ty</span> ) , <span class="op">*</span> ) ) <span class="op">=&gt;</span> { ... };
    (
$ <span class="ident">fn_name</span> : <span class="ident">ident</span> , $ <span class="ident">struct_name</span> : <span class="ident">ident</span> , $ <span class="ident">args</span> : <span class="ident">tt</span> <span class="op">-&gt;</span> $ <span class="ident">return_type</span> : <span class="ident">ty</span>
, $ <span class="ident">docs</span> : <span class="ident">expr</span> , $ <span class="ident">helper_ty_docs</span> : <span class="ident">expr</span> ) <span class="op">=&gt;</span> { ... };
}</pre>
</div><div class='docblock'><p>Declare a sql function for use in your code.</p>
<p>Diesel only provides support for a very small number of SQL functions.
This macro enables you to add additional functions from the SQL standard,
as well as any custom functions your application might have.</p>
<p>The syntax for this macro is very similar to that of a normal Rust function,
except the argument and return types will be the SQL types being used.
Typically these types will come from <a href="../../../../../../oration/schema/threads/columns/_impl_query_id_for_title/diesel/sql_types/index.html" title="`diesel::sql_types`"><code>diesel::sql_types</code></a>.</p>
<p>This macro will generate two items. A function with the name that you've
given, and a module with a helper type representing the return type of your
function. For example, this invocation:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><pre class="rust rust-example-rendered ignore">
<span class="macro">sql_function</span><span class="macro">!</span>(<span class="kw">fn</span> <span class="ident">lower</span>(<span class="ident">x</span>: <span class="ident">Text</span>) <span class="op">-&gt;</span> <span class="ident">Text</span>);</pre>
<p>will generate this code:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><pre class="rust rust-example-rendered ignore">
<span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">lower</span><span class="op">&lt;</span><span class="ident">X</span><span class="op">&gt;</span>(<span class="ident">x</span>: <span class="ident">X</span>) <span class="op">-&gt;</span> <span class="ident">lower</span>::<span class="ident">HelperType</span><span class="op">&lt;</span><span class="ident">X</span><span class="op">&gt;</span> {
    ...
}

<span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">mod</span> <span class="ident">lower</span> {
    <span class="kw">pub</span> <span class="kw">type</span> <span class="ident">HelperType</span><span class="op">&lt;</span><span class="ident">X</span><span class="op">&gt;</span> <span class="op">=</span> ...;
}</pre>
<p>If you are using this macro for part of a library, where the function is
part of your public API, it is highly recommended that you re-export this
helper type with the same name as your function. This is the standard
structure:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><pre class="rust rust-example-rendered ignore">
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">functions</span> {
    <span class="kw">use</span> <span class="kw">super</span>::<span class="ident">types</span>::<span class="kw-2">*</span>;
    <span class="kw">use</span> <span class="ident">diesel</span>::<span class="ident">sql_types</span>::<span class="kw-2">*</span>;

    <span class="macro">sql_function</span><span class="macro">!</span> {
        <span class="doccomment">/// Represents the Pg `LENGTH` function used with `tsvector`s.</span>
        <span class="kw">fn</span> <span class="ident">length</span>(<span class="ident">x</span>: <span class="ident">TsVector</span>) <span class="op">-&gt;</span> <span class="ident">Integer</span>;
    }
}

<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">helper_types</span> {
    <span class="doccomment">/// The return type of `length(expr)`</span>
    <span class="kw">pub</span> <span class="kw">type</span> <span class="ident">Length</span><span class="op">&lt;</span><span class="ident">Expr</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">functions</span>::<span class="ident">length</span>::<span class="ident">HelperType</span><span class="op">&lt;</span><span class="ident">Expr</span><span class="op">&gt;</span>;
}

<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">dsl</span> {
    <span class="kw">pub</span> <span class="kw">use</span> <span class="ident">functions</span>::<span class="kw-2">*</span>;
    <span class="kw">pub</span> <span class="kw">use</span> <span class="ident">helper_types</span>::<span class="kw-2">*</span>;
}</pre>
<p>Most attributes given to this macro will be put on the generated function
(including doc comments).</p>
<h1 id="adding-doc-comments" class="section-header"><a href="#adding-doc-comments">Adding Doc Comments</a></h1>
<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">diesel</span>::<span class="ident">sql_types</span>::<span class="ident">Text</span>;

<span class="macro">sql_function</span><span class="macro">!</span> {
    <span class="doccomment">/// Represents the `canon_crate_name` SQL function, created in</span>
    <span class="doccomment">/// migration ....</span>
    <span class="kw">fn</span> <span class="ident">canon_crate_name</span>(<span class="ident">a</span>: <span class="ident">Text</span>) <span class="op">-&gt;</span> <span class="ident">Text</span>;
}

<span class="kw">let</span> <span class="ident">target_name</span> <span class="op">=</span> <span class="string">&quot;diesel&quot;</span>;
<span class="ident">crates</span>.<span class="ident">filter</span>(<span class="ident">canon_crate_name</span>(<span class="ident">name</span>).<span class="ident">eq</span>(<span class="ident">canon_crate_name</span>(<span class="ident">target_name</span>)));
<span class="comment">// This will generate the following SQL</span>
<span class="comment">// SELECT * FROM crates WHERE canon_crate_name(crates.name) = canon_crate_name($1)</span></pre>
<h1 id="special-attributes" class="section-header"><a href="#special-attributes">Special Attributes</a></h1>
<p>There are a handful of special attributes that Diesel will recognize. They
are:</p>
<ul>
<li><code>#[aggregate]</code>
<ul>
<li>Indicates that this is an aggregate function, and that <code>NonAggregate</code>
should not be implemented.</li>
</ul>
</li>
<li><code>#[sql_name=&quot;name&quot;]</code>
<ul>
<li>The SQL to be generated is different than the Rust name of the function.
This can be used to represent functions which can take many argument
types, or to capitalize function names.</li>
</ul>
</li>
</ul>
<p>Functions can also be generic. Take the definition of <code>sum</code> for an example
of all of this:</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">diesel</span>::<span class="ident">sql_types</span>::<span class="ident">Foldable</span>;

<span class="macro">sql_function</span><span class="macro">!</span> {
    <span class="attribute">#[<span class="ident">aggregate</span>]</span>
    <span class="attribute">#[<span class="ident">sql_name</span> <span class="op">=</span> <span class="string">&quot;SUM&quot;</span>]</span>
    <span class="kw">fn</span> <span class="ident">sum</span><span class="op">&lt;</span><span class="ident">ST</span>: <span class="ident">Foldable</span><span class="op">&gt;</span>(<span class="ident">expr</span>: <span class="ident">ST</span>) <span class="op">-&gt;</span> <span class="ident">ST</span>::<span class="ident">Sum</span>;
}

<span class="ident">crates</span>.<span class="ident">select</span>(<span class="ident">sum</span>(<span class="ident">id</span>));</pre>
<h1 id="use-with-sqlite" class="section-header"><a href="#use-with-sqlite">Use with SQLite</a></h1>
<p>On most backends, the implementation of the function is defined in a
migration using <code>CREATE FUNCTION</code>. On SQLite, the function is implemented in
Rust instead. You must call <code>register_impl</code> or
<code>register_nondeterministic_impl</code> with every connection before you can use
the function.</p>
<p>These functions will only be generated if the <code>sqlite</code> feature is enabled,
and the function is not generic. Generic functions and variadic functions
are not supported on SQLite.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">diesel</span>::<span class="ident">sql_types</span>::{<span class="ident">Integer</span>, <span class="ident">Double</span>};
<span class="macro">sql_function</span><span class="macro">!</span>(<span class="kw">fn</span> <span class="ident">add_mul</span>(<span class="ident">x</span>: <span class="ident">Integer</span>, <span class="ident">y</span>: <span class="ident">Integer</span>, <span class="ident">z</span>: <span class="ident">Double</span>) <span class="op">-&gt;</span> <span class="ident">Double</span>);

<span class="kw">let</span> <span class="ident">connection</span> <span class="op">=</span> <span class="ident">SqliteConnection</span>::<span class="ident">establish</span>(<span class="string">&quot;:memory:&quot;</span>)<span class="question-mark">?</span>;

<span class="ident">add_mul</span>::<span class="ident">register_impl</span>(<span class="kw-2">&amp;</span><span class="ident">connection</span>, <span class="op">|</span><span class="ident">x</span>: <span class="ident">i32</span>, <span class="ident">y</span>: <span class="ident">i32</span>, <span class="ident">z</span>: <span class="ident">f64</span><span class="op">|</span> {
    (<span class="ident">x</span> <span class="op">+</span> <span class="ident">y</span>) <span class="kw">as</span> <span class="ident">f64</span> <span class="op">*</span> <span class="ident">z</span>
})<span class="question-mark">?</span>;

<span class="kw">let</span> <span class="ident">result</span> <span class="op">=</span> <span class="ident">select</span>(<span class="ident">add_mul</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1.5</span>))
    .<span class="ident">get_result</span>::<span class="op">&lt;</span><span class="ident">f64</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="ident">connection</span>)<span class="question-mark">?</span>;
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="number">4.5</span>, <span class="ident">result</span>);</pre>
</div></section><section id="search" class="content hidden"></section><section class="footer"></section><aside id="help" class="hidden"><div><h1 class="hidden">Help</h1><div class="shortcuts"><h2>Keyboard Shortcuts</h2><dl><dt><kbd>?</kbd></dt><dd>Show this help dialog</dd><dt><kbd>S</kbd></dt><dd>Focus the search field</dd><dt><kbd>↑</kbd></dt><dd>Move up in search results</dd><dt><kbd>↓</kbd></dt><dd>Move down in search results</dd><dt><kbd>↹</kbd></dt><dd>Switch tab</dd><dt><kbd>&#9166;</kbd></dt><dd>Go to active search result</dd><dt><kbd>+</kbd></dt><dd>Expand all sections</dd><dt><kbd>-</kbd></dt><dd>Collapse all sections</dd></dl></div><div class="infos"><h2>Search Tricks</h2><p>Prefix searches with a type followed by a colon (e.g. <code>fn:</code>) to restrict the search to a given type.</p><p>Accepted types are: <code>fn</code>, <code>mod</code>, <code>struct</code>, <code>enum</code>, <code>trait</code>, <code>type</code>, <code>macro</code>, and <code>const</code>.</p><p>Search functions by type signature (e.g. <code>vec -> usize</code> or <code>* -> vec</code>)</p><p>Search multiple things at once by splitting your query with comma (e.g. <code>str,u8</code> or <code>String,struct:Vec,test</code>)</p></div></div></aside><script>window.rootPath = "../../../../../../";window.currentCrate = "oration";</script><script src="../../../../../../aliases.js"></script><script src="../../../../../../main.js"></script><script defer src="../../../../../../search-index.js"></script></body></html>